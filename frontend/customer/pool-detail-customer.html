<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết hồ bơi</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">

    <!-- Icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>

    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="index-customer.html">Quản lý hồ bơi</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index-customer.html">Trang chủ</a></li>
                    <a class="nav-link dropdown-toggle" href="#" id="userMenu" role="button" data-bs-toggle="dropdown">
                        <i class="fa-solid fa-user text-white" style="font-size: 1rem;"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
                        <li><a class="dropdown-item" href="profile.html">Thông tin cá nhân</a></li>
                        <li><a class="dropdown-item" onclick="logout()">Đăng xuất</a></li>
                    </ul>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Ảnh đại diện -->
    <div class="text-center mb-3">
        <img src="img/muongthanh-pool.png" alt="Hồ bơi ABC" class="img-fluid rounded">
    </div>

    <!-- Main Content -->
    <div class="container mt-3">
        <!-- Thông tin hồ bơi -->
        <div class="card mb-3">
            <div class="card-header bg-primary text-white">Thông tin hồ bơi</div>
            <div class="card-body">
                <h2 id="poolName">Hồ bơi ABC</h2>
                <p><strong>Địa chỉ:</strong> <span id="poolAddress">123 Đường X, Phường Y, Quận Z</span></p>
                <p><strong>Loại hình:</strong> <span id="poolType">Công cộng</span></p>
                <p><strong>Giờ mở cửa:</strong> <span id="poolHours">06:00 - 22:00</span></p>
                <p><strong>Mô tả:</strong> <span id="poolDescription">Hồ bơi sạch đẹp, có khu vực dành cho trẻ em và
                        người lớn.</span></p>

                <!-- Thêm thông tin tọa độ -->
                <p><strong>Tọa độ GPS:</strong>
                    <span id="poolLatitude">10.762622</span>,
                    <span id="poolLongitude">106.660172</span>
                </p>
                <p><strong>Kích thước hồ bơi:</strong></p>
                <ul>
                    <li><strong>Chiều dài:</strong> <span id="poolLength">25m</span></li>
                    <li><strong>Chiều rộng:</strong> <span id="poolWidth">10m</span></li>
                    <li><strong>Độ sâu tối đa:</strong> <span id="poolDepth">2m</span></li>
                </ul>

                <br>
                <form id="feeForm">
                    <div class="mb-3">
                        <label for="doiTuong" class="form-label"><strong>Chọn đối tượng:</strong></label>
                        <select id="doiTuong" class="form-select">
                            <option value="nguoiLon">Người lớn</option>
                            <option value="treEm">Trẻ em</option>
                            <option value="hocSinhSinhVien">Học sinh/ Sinh viên</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="poolFee" class="form-label"><strong>Phí vào cổng:</strong></label>
                        <input type="text" class="form-control" id="poolFee" readonly>
                    </div>
                </form>

            </div>
        </div>

        <!-- Tiện ích và dịch vụ -->
        <div class="card mb-3">
            <div class="card-header bg-primary text-white">Tiện ích và dịch vụ</div>
            <div class="card-body">
                <form id="servicesForm">
                    <div class="mb-3">
                        <label for="servicesDropdown" class="form-label">Chọn tiện ích/ dịch vụ:</label>
                        <select id="servicesDropdown" class="form-select">
                            <option value="khuTamNang">Khu vực tắm nắng</option>
                            <option value="phongThayDo">Phòng thay đồ</option>
                            <option value="khuVuiChoiTreEm">Khu vui chơi trẻ em</option>
                            <option value="choThueDoBoi">Cho thuê đồ bơi</option>
                            <option value="dichVuHuongDanBoi">Dịch vụ huấn luyện viên bơi lội</option>
                        </select>
                    </div>
                </form>

                <!-- Hiển thị phí -->
                <div class="mt-3">
                    <p><strong>Phí:</strong> <span id="serviceFee">0 VNĐ</span></p>
                </div>
            </div>
        </div>

        <!-- Các sự kiện tại hồ bơi -->
        <div class="card mb-3">
            <div class="card-header bg-primary text-white">Sự kiện</div>
            <div class="card-body">
                <div class="row">
                    <!-- Cột trái: Form lọc sự kiện -->
                    <div class="col-md-4">
                        <form id="eventFilterForm">
                            <div class="mb-3">
                                <label for="filterDate" class="form-label">Chọn thời gian:</label>
                                <input type="date" id="filterDate" class="form-control">
                            </div>
                            <div class="mb-3">
                                <label for="filterType" class="form-label">Chọn loại sự kiện:</label>
                                <select id="filterType" class="form-select">
                                    <option value="all">Tất cả</option>
                                    <option value="competition">Giải đấu</option>
                                    <option value="training">Buổi học</option>
                                </select>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="filterEvents()">Tìm Kiếm</button>
                        </form>
                    </div>

                    <!-- Cột phải: Danh sách sự kiện -->
                    <div class="col-md-8">
                        <div class="event-header">
                            <span>Tên sự kiện</span>
                            <span>Ngày</span>
                            <span>Giờ</span>
                            <span>Tiền</span>
                            <span>Số lượng</span>
                            <span>Hành động</span>
                        </div>
                        <ul class="list-group event-list" id="eventList">
                            <li class="list-group-item">
                                <a>Giải bơi lội thiếu nhi</a>
                                <span>25/02/2025</span>
                                <span>10:30</span>
                                <span>250000</span>
                                <span>14</span>
                                <button class="btn btn-primary"
                                    onclick="openRegisterForm('Giải bơi lội thiếu nhi')">Đăng ký</button>
                            </li>
                            <li class="list-group-item">
                                <a>Buổi học bơi miễn phí</a>
                                <span>25/02/2025</span>
                                <span>10:30</span>
                                <span>250000</span>
                                <span>14</span>
                                <button class="btn btn-primary" onclick="openRegisterForm('Buổi học bơi miễn phí')">Đăng
                                    ký</button>
                            </li>
                            <li class="list-group-item">
                                <a>Tham quan hồ bơi ABC</a>
                                <span>25/02/2025</span>
                                <span>10:30</span>
                                <span>250000</span>
                                <span>14</span>
                                <button class="btn btn-primary" onclick="openRegisterForm('Tham quan hồ bơi ABC')">Đăng
                                    ký</button>
                            </li>
                            <li class="list-group-item">
                                <a>Tham quan hồ bơi CDF</a>
                                <span>25/02/2025</span>
                                <span>10:30</span>
                                <span>250000</span>
                                <span>14</span>
                                <button class="btn btn-primary" onclick="openRegisterForm('Tham quan hồ bơi CDF')">Đăng
                                    ký</button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Đăng Ký Sự Kiện -->
        <div class="modal fade" id="registerEventModal" tabindex="-1" aria-labelledby="registerEventModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="registerEventModalLabel">Đăng Ký Sự Kiện</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="registerEventForm" onsubmit="return validateRegistration()">
                            <div class="mb-3">
                                <label class="form-label">Tên sự kiện:</label>
                                <input type="text" class="form-control" id="eventName" readonly>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Họ và tên:</label>
                                <input type="text" class="form-control" id="userName" placeholder="Nhập họ và tên">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Số điện thoại:</label>
                                <input type="text" class="form-control" id="userPhone" placeholder="Nhập số điện thoại">
                            </div>
                            <button type="submit" class="btn btn-primary">Xác nhận đăng ký</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vị trí trên bản đồ -->
        <div class="card mb-3">
            <div class="card-header bg-primary text-white">Vị trí trên bản đồ</div>
            <div class="card-body">
                <div id="map" style="height: 400px;"></div>
            </div>
        </div>

        <!-- Đánh giá và phản hồi -->
        <div class="card mb-3">
            <div class="card-header bg-primary text-white">Đánh giá và phản hồi</div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="feedback" class="form-label">Đánh giá của bạn</label>
                    <div class="star-rating">
                        <i class="fas fa-star star" data-value="1"></i>
                        <i class="fas fa-star star" data-value="2"></i>
                        <i class="fas fa-star star" data-value="3"></i>
                        <i class="fas fa-star star" data-value="4"></i>
                        <i class="fas fa-star star" data-value="5"></i>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="feedback" class="form-label">Phản hồi của bạn</label>
                    <textarea class="form-control" id="feedback" rows="3"
                        placeholder="Nhập đánh giá của bạn..."></textarea>
                </div>
                <button onclick="handleFeedback()" class="btn btn-primary">Gửi</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-primary text-white text-center py-3 mt-3">
        <p>&copy; 2025 Quản lý hồ bơi. Tất cả các quyền được bảo lưu.</p>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Custom JS -->
    <script src="js/main.js"></script>

    <!-- Custom JS -->
    <script>
        // Khởi tạo bản đồ
        var map = L.map('map').setView([10.762622, 106.660172], 15); // Toạ độ trung tâm
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Thêm marker demo
        var marker = L.marker([10.762622, 106.660172]).addTo(map);
        marker.bindPopup("<b>Hồ bơi ABC</b><br>Địa chỉ: 123 Đường X").openPopup();

        // Rating
        const stars = document.querySelectorAll(".star-rating .star");
        let selectedRating = 0;

        stars.forEach(star => {
            star.addEventListener("mouseover", function () {
                resetStars();
                highlightStars(this.getAttribute("data-value"));
            });

            star.addEventListener("click", function () {
                selectedRating = this.getAttribute("data-value");
                persistSelection();
                console.log("Đánh giá: " + selectedRating);
            });

            star.addEventListener("mouseleave", function () {
                resetStars();
                if (selectedRating > 0) {
                    highlightStars(selectedRating);
                }
            });
        });

        function highlightStars(rating) {
            for (let i = 0; i < rating; i++) {
                stars[i].classList.add("hover");
            }
        }

        function resetStars() {
            stars.forEach(star => {
                star.classList.remove("hover");
            });
        }

        function persistSelection() {
            stars.forEach(star => {
                star.classList.remove("selected");
            });
            for (let i = 0; i < selectedRating; i++) {
                stars[i].classList.add("selected");
            }
        }

        function openRegisterForm(eventName) {
            document.getElementById('eventName').value = eventName;
            let registerModal = new bootstrap.Modal(document.getElementById('registerEventModal'));
            registerModal.show();
        }

        function validateRegistration() {
            let userName = document.getElementById('userName').value.trim();
            let userPhone = document.getElementById('userPhone').value.trim();
            if (userName === "" || userPhone === "") {
                alert("Vui lòng điền đầy đủ thông tin trước khi đăng ký!");
                return false;
            }
            alert("Đăng ký thành công!");
            return true;
        }

        function logout() {
            // Lấy thông tin người dùng từ localStorage
            const authToken = localStorage.getItem("authToken");  // Lấy token từ "authToken"

            if (!authToken) {
                alert("Bạn chưa đăng nhập!");
                return;  // Nếu không có token, thông báo và dừng lại
            }

            // Gửi yêu cầu POST tới API để đăng xuất
            fetch("http://127.0.0.1:8000/api/logout", {
                method: "POST",  // Sử dụng phương thức POST
                headers: {
                    "Content-Type": "application/json",  // Đảm bảo gửi dữ liệu ở dạng JSON
                    "Authorization": `Bearer ${authToken}`  // Gửi token qua header Authorization
                }
            })
                .then(response => response.json())  // Chuyển phản hồi từ server thành JSON
                .then(data => {
                    // Kiểm tra mã trạng thái phản hồi
                    if (data.status === "success" || data.status === 200) {
                        alert("Đăng xuất thành công!");
                        // Xóa thông tin người dùng và token khỏi localStorage
                        localStorage.removeItem("authToken");
                        localStorage.removeItem("loggedInUser");
                        // Chuyển hướng đến trang đăng nhập
                        window.location.href = "login.html";
                    } else {
                        // Nếu có lỗi, hiển thị thông báo lỗi
                        alert(data.message || "Có lỗi xảy ra, vui lòng thử lại!");
                    }
                })
                .catch(error => {
                    // Xử lý lỗi nếu có sự cố khi gọi API
                    console.error("Lỗi khi gọi API logout:", error);
                    alert("Có lỗi xảy ra, vui lòng thử lại!");
                });
        }
    </script>
</body>

</html>