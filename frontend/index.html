<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <div class="search-bar">
        <input type="text" id="searchType" placeholder="Nhập loại hồ bơi...">
        <button onclick="searchByType()">Tìm kiếm</button>
        <button onclick="searchByLocation()">Gần tôi</button>
    </div>
    
    <div id="map" style="width: 100%; height: 500px;"></div>

    <script>
        // Khởi tạo bản đồ Leaflet
        var map = L.map('map').setView([10.0279603, 105.7664918], 13);

        // Thêm lớp nền bản đồ từ OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Định nghĩa các icon tùy chỉnh cho từng loại hồ bơi
        var iconByType = {
            "Hồ bơi công cộng": L.icon({
                iconUrl: 'https://example.com/public_pool_icon.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32],
                popupAnchor: [0, -32]
            }),
            "Hồ bơi tư nhân": L.icon({
                iconUrl: 'https://example.com/private_pool_icon.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32],
                popupAnchor: [0, -32]
            }),
            "Hồ bơi trẻ em": L.icon({
                iconUrl: 'https://example.com/child_pool_icon.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32],
                popupAnchor: [0, -32]
            })
        };

        // Hàm fetch API từ backend Laravel
        async function fetchPools() {
            try {
                let response = await fetch("http://127.0.0.1:8000/api/pools");
                if (!response.ok) {
                    throw new Error("Lỗi kết nối API");
                }
                let pools = await response.json();

                // Thêm marker cho từng hồ bơi
                pools.forEach(pool => {
                    let poolIcon = iconByType[pool.type] || L.icon({
                        iconUrl: 'https://example.com/default_pool_icon.png',
                        iconSize: [32, 32],
                        iconAnchor: [16, 32],
                        popupAnchor: [0, -32]
                    });

                    let marker = L.marker([pool.lat, pool.lng], { icon: poolIcon }).addTo(map);
                    
                    let wardName = pool.street?.ward?.name || 'Không có ward';
                    let districtName = pool.street?.ward?.district?.name || 'Không có district';

                    marker.bindPopup(`
                        <b>${pool.name}</b><br>
                        Địa chỉ: ${pool.house_number} ${pool.street_name}<br>
                        Loại: ${pool.type}<br>
                        Giá trẻ em: ${pool.children_price} VND<br>
                        Giá người lớn: ${pool.adult_price} VND<br>
                        Giá học sinh: ${pool.student_price} VND<br>
                        Phường: ${wardName}<br>
                        Quận: ${districtName}
                    `);
                });
            } catch (error) {
                console.error("Lỗi khi tải danh sách hồ bơi:", error);
            }
        }

        // Gọi hàm fetch API khi trang tải xong
        fetchPools();
    </script>
        <script>
            var lat_ctu=10.030671
            var lng_ctu =105.771502
            let market_ctu = L.marker([lat_ctu,lng_ctu]).addTo(map)
        </script>    
        
</body>
</html>
