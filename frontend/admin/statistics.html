<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thống Kê Hồ Bơi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css"> <!-- Thêm CSS của bạn -->
</head>

<body>
    <!-- Thanh điều hướng -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Quản Lý Dịch Vụ Hồ Bơi</a>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link active" href="index.html">Trang Chủ</a></li>
                <li class="nav-item"><a class="nav-link" href="pool-management.html">Quản Lý Hồ Bơi</a></li>
                <li class="nav-item"><a class="nav-link active" href="service-management.html">Quản Lý Dịch Vụ</a></li>
                <!-- <li class="nav-item"><a class="nav-link" href="service-management2.html">Quản Lý Dịch Vụ Của Hồ Bơi</a></li> -->
                <li class="nav-item"><a class="nav-link" href="event-management.html">Quản Lý Sự Kiện</a></li>
                <li class="nav-item"><a class="nav-link" href="facility-management.html">Quản Lý Tiện Ích</a></li>
                <li class="nav-item"><a class="nav-link" href="eventregistrations.html">Quản Lý Phiếu Đăng Ký</a></li>
                <li class="nav-item"><a class="nav-link" href="infor-customer.html">Thông Tin Khách Hàng</a></li>
                <li class="nav-item"><a class="nav-link" href="review-management.html">Đánh Giá Khách Hàng</a></li>
                <li class="nav-item"><a class="nav-link" href="statistics.html">Thống kê</a></li>

            </ul>
            <ul class="navbar-nav ms-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="adminDropdown" role="button"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="img/admin.jpg" alt="Admin" class="rounded-circle"
                            style="width: 30px; height: 30px; margin-right: 8px;">
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="adminDropdown">
                        <li><a class="dropdown-item" href="profile.html">Hồ Sơ</a></li>
                        <li><a class="dropdown-item text-danger" href="logout.html">Đăng Xuất</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container mt-5">
        <h2>Thống Kê Hồ Bơi</h2>

        <!-- Thống kê tổng quan -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Tổng Số Hồ Bơi</h5>
                        <p id="totalPools" class="card-text">0</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Tổng Sự Kiện</h5>
                        <p id="totalEvents" class="card-text">0</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Tổng Dịch Vụ</h5>
                        <p id="totalServices" class="card-text">0</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Tổng Tiện Ích</h5>
                        <p id="totalUtilities" class="card-text">0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Biểu đồ thống kê số hồ bơi theo loại -->
        <div class="mb-4">
            <canvas id="poolTypeChart"></canvas>
        </div>

        <!-- Phân trang -->
        <nav>
            <ul class="pagination justify-content-center" id="pagination">
                <!-- Các trang sẽ được thêm vào đây qua JavaScript -->
            </ul>
        </nav>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function () {
            // Gọi API để lấy dữ liệu hồ bơi, sự kiện, dịch vụ và đánh giá
            $.ajax({
                url: '/api/statistics', // Đường dẫn API của bạn để lấy tất cả dữ liệu
                method: 'GET',
                success: function (data) {
                    const pools = data.pools;
                    const events = data.events;
                    const services = data.services;
                    const reviews = data.reviews;

                    // Tính toán thống kê tổng quan
                    const totalPools = pools.length;
                    const totalEvents = events.length;
                    const totalServices = services.length;
                    const totalUtilities = pools.reduce((sum, pool) => sum + pool.utilityCount, 0);

                    // Cập nhật các thông tin thống kê
                    $('#totalPools').text(totalPools);
                    $('#totalEvents').text(totalEvents);
                    $('#totalServices').text(totalServices);
                    $('#totalUtilities').text(totalUtilities);

                    // Hiển thị các hồ bơi trong bảng
                    pools.forEach((pool, index) => {
                        const poolEvents = events.filter(event => event.id_pool === pool.id_pool).length;
                        const poolServices = services.filter(service => service.pool_id === pool.id_pool).length;
                        const poolReviews = reviews.filter(review => review.id_pool === pool.id_pool);
                        const reviewCount = poolReviews.length;
                        const avgRating = reviewCount > 0 ? (poolReviews.reduce((sum, review) => sum + review.rating, 0) / reviewCount).toFixed(1) : 'Chưa có đánh giá';

                        $('#poolList').append(`
                            <tr>
                                <td>${index + 1}</td>
                                <td>${pool.name}</td>
                                <td>${pool.type}</td>
                                <td>${poolEvents}</td>
                                <td>${poolServices}</td>
                                <td>${pool.utilityCount}</td>
                                <td>${reviewCount}</td>
                                <td>${avgRating}</td>
                            </tr>
                        `);
                    });

                    // Biểu đồ thống kê số hồ bơi theo loại
                    const poolTypes = pools.map(pool => pool.type);
                    const uniqueTypes = [...new Set(poolTypes)];
                    const typeCounts = uniqueTypes.map(type => poolTypes.filter(t => t === type).length);

                    const ctx = document.getElementById('poolTypeChart').getContext('2d');
                    const poolTypeChart = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: uniqueTypes,
                            datasets: [{
                                label: 'Số Hồ Bơi Theo Loại',
                                data: typeCounts,
                                backgroundColor: ['#FF5733', '#33FF57', '#3357FF', '#F2C9F1'],
                                borderColor: '#ffffff',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true
                        }
                    });
                },
                error: function (error) {
                    console.log('Error fetching data:', error);
                }
            });
        });
    </script>
</body>

</html>